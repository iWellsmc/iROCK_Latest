{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% load custom_tags %}
{% load contract_tags %}
{% block content %}

<link rel="stylesheet" type="text/css" href="{% static 'assets/css/master/vendorcontract.css' %}">
<section id="data-list-view" class="data-list-view-header">
<div>
    <h3 class="from-head">Vendor Contract Master</h3>
    <input type="hidden" name="dateformat" id="companydateformat" value={{company.dateformat}}>
    <div class="row my-4">
      
    <form method="POST" class="bot-sp-sea" id="con_form" enctype="multipart/form-data">
      {% csrf_token %}
    <div class="row justify-content-end">
        <div class="col-6 col-md-4">
          <div class="upload-btn-wrapper ">
            {% if request.user.roles_id == 3 %}
              {%if rights.create == '1' %}    
              <!-- <a data-toggle="modal" href="#myModal" class="btn btn-clr btn-master im-port-cont">Import Contract</a> -->
              <div class="modal" id="myModal">
                  <div class="modal-dialog modal-lg modal-box_sty">
                    <div class="modal-content dow-temp-width">
                        <div class="modal-header">
                          <h4 class="modal-title">
                            Import or Download Excel Template
                            </h4>    
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        </div>
                        <div id="loader" class="lds-dual-ring hidden overlay">
                          <h5 class="head_cls">Please Wait...</h5>
                        </div>
                        <div class="container"></div> 
                        <div class="modal-body">
                          <div class="row">
                            <div class="col-8">
                            </div>                          
                            <div class="col-4">
                              <button type="submit" class="btn btn-clr btn-master down-excel-temp downloadcls"><a href="{% url 'projects:createexcelsheet' %}">Download Excel Template</a></button>
                            </div>
                          </div>
                          
                          <div class="row">
                            <div class="col-3">
                              <label class="list-txt">Project</label>
                            <select name="projects" id="id_projects" class="projectcls form-control pop-input-line">
                              <option value="">--Select--</option>
                              {% for project in projects %}
                              <option value="{{project.id}}" title="{{project.projectname.name}}">{{project.projectname.name}}</option>
                              {% endfor %}
                            </select>
                            </div>
                            <div class="col-3">
                              <label class="list-txt">Discipline</label>
                            <select type id="project_discipline" name="project_discipline"class="form-control p_discipline_cls pop-input-line">
                              <option value="">--Select--</option>
                            </select>
                            </div>
                            <div class="col-3">
                              <label class="list-txt">Discipline Type</label>
                            <select name="disciplinetype" id="disciplinetype_id" class="form-control pop-input-line" ><option value="">--Select--</option>
                            </select>
                            </div>
                            <div class="col-3">
                              <label class="pop-hed"></label>
                            <input type="file" name="contractfile" class="checkfileformat mt-3 che-file-wd filesize"><br><span class="maxmp">(Max: 25MB)</span><br><span class="file-error-message"></span>
                            </div>
                          </div>
                        </div>
                        <div class="modal-footer">
                          <button type="submit" data-toggle="modal" href="#myModal3" class="btn btn-clr btn-master con_file_id">Upload</button>
                          <!-- <a href="#" data-dismiss="modal" class="btn btn-clr btn-master">Close</a> -->
                        </div>
                    </div>
                  </div>
              </div>
              {% endif %}
            {% else %}
            <!-- <a data-toggle="modal" href="#myModal" class="btn btn-clr btn-master im-port-cont">Import Contract</a> -->

            <div class="modal" id="myModal">
                <div class="modal-dialog modal-lg modal-box_sty" >
                  <div class="modal-content dow-temp-width ven-con-mas-pop">
                      <div class="modal-header">
                        <h4 class="modal-title">
                          Import or Download Excel Template
                          </h4>    
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                      </div>
                      <div id="loader" class="lds-dual-ring hidden overlay">
                        <h5 class="head_cls">Please Wait...</h5>
                      </div>
                      <div class="container"></div> 
                      <div class="modal-body">
                        <div class="row">                
                          <div class="col-12 text-end pr-4">
                            <button type="submit" class="btn btn-clr downloadcls"><a href="{% url 'projects:createexcelsheet' %}">Download Excel Template</a></button>
                            <!--button class removed - | btn-master down-excel-temp  -->
                          </div>
                        </div>
                        <div class="row align-items-end">
                          <div class="col-3">
                            <label class="list-txt">Project</label>
                          <select name="projects" id="id_projects" class="projectcls form-control form-select pop-input-line">
                            <option value="">--Select--</option>
                            {% for project in projects%}
                            <option value="{{project.id}}">{{project.projectname.name}}</option>
                            {% endfor %}
                          </select>
                          </div>
                          <div class="col-3">
                            <label class="list-txt">Discipline</label>
                          <select type id="project_discipline" name="project_discipline"class="form-control form-select p_discipline_cls pop-input-line">
                            <option value="">--Select--</option>
                          </select>
                          </div>
                          <div class="col-3">
                            <label class="list-txt">Discipline Type</label>
                          <select name="disciplinetype" id="disciplinetype_id" class="form-control form-select pop-input-line" ><option value="">--Select--</option>
                          </select>
                          </div>
                          <div class="col-3">
                            <label class="pop-hed"></label>
                          <input type="file" name="contractfile" class="checkfileformat import-check che-file-wd filesize" > <br><span class="maxmp">(Max: 25MB)</span><br><span class="file-error-message"></span>
                          </div>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="submit" data-toggle="modal" href="#myModal3" class="btn btn-clr btn-master con_file_id">Upload</button>
                        <!-- <a href="#" data-dismiss="modal" class="btn btn-clr btn-master">Close</a> -->
                      </div>
                  </div>
                </div>
            </div>
            {% endif %}
            </div>
          </div>
          <div class="col-6 col-md-8 pr-0">
            {% if request.user.roles_id == 3 %}
              {%if rights.create == '1' %} 
                <a class="btn btn-clr btn-master chck-tst" href="{% url 'projects:createnewcontractmaster' %}">Add Contract</a>
                <!-- <a class="btn btn-clr btn-master chck-tst" href="{% url 'projects:addfilescontract' %}">Add Files</a> -->
                <button type="button" class="btn btn-clr btn-master chck-tst"  data-target="#exampleModal"><a href="{% url 'projects:specificreportgenerate' %}">Generate Report</a></button>
              {% endif %}
            {% else %}
              <a class="btn btn-clr btn-master chck-tst" href="{% url 'projects:createnewcontractmaster' %}">Add Contract</a>
              {% comment %} <a class="btn btn-clr btn-master chck-tst" href="{% url 'projects:createcontractmaster' %}">Add Contract</a> {% endcomment %}
              <!-- <a class="btn btn-clr btn-master chck-tst" href="{% url 'projects:addfilescontract' %}">Add Files</a> -->
              <button type="button" class="btn btn-clr btn-master chck-tst"  data-target="#exampleModal"><a href="{% url 'projects:specificreportgenerate' %}">Generate Report</a></button>
            {% endif %}
          </div>
        </div>
        
    <div class="row">
      <div class="col-12">
        {%if rights.view == '1' and rights.create != '1' %} 
          <button type="button"  class="btn btn-clr btn-master chck-tst mr-0"  data-target="#exampleModal"><a href="{% url 'projects:specificreportgenerate' %}">Generate Report</a></button>
        {% endif %}
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-6"> 
        <div class="card all-noti-box">
          <div class="show-noti p-0">
              <label>Show <select id="datafilters" class="changevalue select-style">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
          </select> entries</label>
          </div>
        </div>
      </div>
      <div class="col-6 text-end">
        <div class="sear-box-ryt" style="float: none !important; margin: 0 !important;">
          <input type="text" id="myInput" class="search-f-inf" name="searchvendor" placeholder="Search for Vendor Name" value="{{se_vendor}}">
          <!-- <button type="button" class="v_search"><i class="fa fa-search sea-rch-clr"></i></button> -->
        </div>
      </div>
    </div>
    <!-- <div class="row ads">
      {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li  {% if message.tags %} class="{{ message.tags }} msg-cls" {% endif %}> {{ message }} </li>
            {% endfor %}
        </ul>
      {% endif %}
    </div> -->
    


    <div class="table-responsive text-nowrap">
    <table class="table settings-data-list-view data-list-view ascen-descen-class irock-table prj-back_clr" id="master_project_list">
        <thead >
            <tr >
                <th class="text-wrap">S/N</th> 
                <th class="vin-width text-wrap">Vendor Identification Number (VIN)

                  <button type="button" class="sort up-arr line-hight-zero" name="asc">
                    <svg width="14" height="7" viewBox="0 0 14 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 0L13.0622 6.75H0.937822L7 0Z" fill="#A11D40"/>
                      </svg>
                    <!-- <a href="{% url 'projects:vendormasterlist'%}"><</a> -->
                    <!-- <i class="fa fa-sort-asc" aria-hidden="true"></i>-->
                  </button> 

                    <button type="button" class="sort down-arr line-hight-zero" name="dec">
                      <!-- <a href="{% url 'projects:vendormasterlist'%}">></a> -->
                      <!-- <i class="fa fa-sort-desc" aria-hidden="true"></i> -->
                      <svg width="14" height="7" viewBox="0 0 14 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 7L13.0622 0.25H0.937822L7 7Z" fill="#A11D40"/>
                        </svg>
                    </button></th> 
                      
                      
                  <th class="text-wrap">Vendor Name  
                    
                  <button type="button" class="sortname up-arr line-hight-zero" name="asc">
                    <svg width="14" height="7" viewBox="0 0 14 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 0L13.0622 6.75H0.937822L7 0Z" fill="#A11D40"/>
                      </svg>
                    <!-- <i class="fa fa-sort-asc" aria-hidden="true"></i> -->
                    
                  </button>

                    <button type="button" class="sortname down-arr line-hight-zero" name="dec">
                      
                      <svg width="14" height="7" viewBox="0 0 14 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7 7L13.0622 0.25H0.937822L7 7Z" fill="#A11D40"/>
                        </svg>
                    </button></th>
                <th class="text-wrap">Actions</th>
                <!-- Add/Edit/View Taxes and Currency Split -->
            </tr>
        </thead>
        <tbody class="table-list">
          {% if contractmastercount > 0 %}
            {% for contracts in contractlist %}
            <tr>
              <td class="cont_tab-li">{{contractlist.start_index|add:forloop.counter0 }}</td>    

                <td class="cont_tab-li">{{contracts.vin}}</td>
                <td class="cont_tab-li">{{contracts.vendor_name}}</td>
                <td class="cont_tab-li">
                  {% if request.user.roles_id == 3 %}
                    {%if rights.view == '1' %} 
                        <a class="btn p-0 showtoggle" data-toggle="collapse" href="#collapseExample{{contracts.id}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                          <span class="action-edit align-icons">
                            <i class="fa fa-eye" title="View"></i>
                          </span>
                        </a>
                    {% endif %}
                  {% else %}
                    <a class="btn p-0 showtoggle" data-toggle="collapse" href="#collapseExample{{contracts.id}}" role="button" aria-expanded="false" aria-controls="collapseExample">
                      <span class="action-edit align-icons">
                        <i class="fa fa-eye" title="View" ></i>
                      </span>
                    </a>
                  {% endif %}

                  {% if request.user.roles_id == 3 %}
                    {%if rights.edit == '1' %} 
                      {% if contracts.active_status == 1%}
                        {% comment %} <a class="btn p-0" href="{% url 'projects:editcontractmaster' pk=contracts.id%}">
                          <span class="action-edit align-icons">
                            <i class="fa fa-edit" title="Edit" ></i>
                          </span>
                        </a> {% endcomment %}
                        {% endif %}
                    {% endif %}
                {% else %}
            
                {% endif %}
 

                {% comment %} {% if request.user.roles_id == 3 %}
                  {%if rights.delete == '1' %} 
                    {% with contracts.id|check_contract_invoice:"vendor" as invoice_count %}
                      {% if invoice_count == 0 %}
                        <a class="btn p-0 delete-contract" data_id="{{contracts.id}}" contract_name="{{contracts.vendor_name}}">
                          <span class="action-edit align-icons">
                            <i class="fa fa-trash-o" title="Delete" ></i>
                          </span>
                        </a> 
                        {% endif %}
                      {% endwith %}
                {% endif %}
              {% else %}
              {% with contracts.id|check_contract_invoice:"vendor" as invoice_count %}
                {% if invoice_count == 0 %}
                  <a class="btn p-0 delete-contract" data_id="{{contracts.id}}" contract_name="{{contracts.vendor_name}}">
                    <span class="action-edit align-icons">
                      <i class="fa fa-trash-o" title="Delete"></i>
                    </span>
                  </a> 
                {% endif %}
              {% endwith %}
              {% endif %} {% endcomment %}
              <a class="btn p-0" target="_blank" href="{% url 'projects:generatespecificvendor' pk=contracts.id%}">
                <span class="action-edit align-icons">
                  <i title='Generate Specific Vendor Contract Report' class="fas fa-file-pdf" ></i>
                </span>
              </a> 
                </td>
            </tr>
            <tr>
              <td colspan='12' class="tbl-top-lines p-0">
                <div class="collapse" id="collapseExample{{contracts.id}}">
                  <div class="card card-body m-0">

                    {% if contracts.id|servicecontractcount:"service" > 0 %}
                    <h3 class="from-head">Services</h3>
                    <div class="table-responsive text-nowrap contract-master-service-table-div">
                    <table class="type-last-vend mid-view-tbl tlt-cap m-ven-cus-mas tbl-contra-list v-c-master size-of_tbl contract-master-service-table">
                      <thead>
                      <tr>
                        <th class="wid-sn">S/N</th>
                        <th class="text-al_cen text-wrap">Name of Service</th>
                        <th class="text-al_cen text-wrap">Project Name</th>
                        <th class="text-al_cen text-wrap">Project Discipline</th>
                        <th class="text-al_cen text-wrap">Discipline Type</th>
                        <th class="text-al_cen text-wrap">SO Reference Number</th>
                        <th class="text-al_cen text-wrap">SO Executed Date</th>
                        <th class="text-al_cen text-wrap">Maximum Value of SO</th>
                        <th class="text-al_cen text-wrap">Actions</th>
                      </tr>
                      </thead>
                      
                      <tbody class="seek-left">
                    {% for service in contracts.id|servicecontract:"service"%}
                    {% check_for_amendment service.id request as supply_count %}
                      {% cheack_serviceademdmentcontract service.id request.user.company.id as data %}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{service.name_service|default_if_none:"---"}}</td>
                        <td class="text-left">{{service.projects.projectname|default_if_none:"---"}}</td>
                        <td class="text-left">{{service.projectdiscipline|convert_projectdiscipline|default_if_none:"---"}}</td>
                        <td>{{service.projectdisciplinetype.discipline_subtype|default_if_none:"---"}}</td>
                        <td>{{service.reference_number|default_if_none:"---"}}</td>
                        <td>{{service.executed_date|checktime:request.user.company.id|default_if_none:"---"}}</td>
                        <td>{{service.currency.currency_symbol|default_if_none:"---"}} {{service.amount|amount_convertion_to_separtors|default_if_none:"---"}}</td>
                        {% comment %} <td>{{forloop.counter}}</td> {% endcomment %}
                        {% comment %} <td>{{data.contract_name}}</td> {% endcomment %}
                        {% comment %} <td class="td-left">{{data.projects}}</td> {% endcomment %}
                        {% comment %} <td class="td-left">{{data.Project_discipline}}</td> {% endcomment %}
                        {% comment %} <td>{{data.projectdiscipline_type}}</td> {% endcomment %}
                        {% comment %} <td>{{data.Reference_Number}}</td> {% endcomment %}
                        {% comment %} <td>{{data.Executed_Date}}</td> {% endcomment %}
                        {% comment %} <td>{{data.Maximum_Value}}</td> {% endcomment %}
                        
                       
                       
                        <td class="td-center">
                          {% if service.save_type == 1 %}
                          {% if supply_count > 0 %}
                          {% with service.id|check_contract_invoice:"original" as invoice_count %}
                            {% if invoice_count == 0 %}
                            {% if request.user.roles_id == 3 %}
                              {% if rights.create == '1' or rights.edit == '1'%} 
                                <a href="{% url 'projects:createvendortax' contracttype="original" id=service.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              {%else%}
                                <a href="{% url 'projects:createvendortax' contracttype="original" id=service.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              
                            {% endif %}
                          {% endwith %}
                          {% with service.id|check_contract_tax:"original" as tax_count %}
                            {% if tax_count > 0 %}
                              <a href="{% url 'projects:viewvendortax' contracttype="original" id=service.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                            {% endif %}
                          {% endwith %}
                          {% endif %}
                          {% else %}
                          {% with service.id|check_contract_invoice:"original" as invoice_count %}
                            {% if invoice_count == 0 %}
                            {% if request.user.roles_id == 3 %}
                              {% if rights.create == '1' or rights.edit == '1'%} 
                                <a href="{% url 'projects:createvendortax' contracttype="original" id=service.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              {%else%}
                                <a href="{% url 'projects:createvendortax' contracttype="original" id=service.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              
                            {% endif %}
                          {% endwith %}
                          {% with service.id|check_contract_tax:"original" as tax_count %}
                            {% if tax_count > 0 %}
                              <a href="{% url 'projects:viewvendortax' contracttype="original" id=service.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                            {% endif %}
                          {% endwith %}

                          {% endif %}

                          {% comment %} {% with service.id|check_contract_invoice:data.type as invoice_count %}
                            {% if invoice_count == 0 %}
                            {% if request.user.roles_id == 3 %}
                               {% if rights.create == '1' or  rights.edit == '1'%} 
                              <a href="{% url 'projects:createvendortax' contracttype=data.type id=data.tax_id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              {%else%}
                              <a href="{% url 'projects:createvendortax' contracttype=data.type id=data.tax_id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                            {% endif %}
                          {% endwith %}
                          {% with service.id|check_contract_tax:data.type as tax_count %}
                            {% if tax_count > 0 %}
                              <a href="{% url 'projects:viewvendortax' contracttype="original" id=service.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                            {% endif %}
                          {% endwith %} {% endcomment %}
                          
                          <a href="/projects/contract_detailed_view/{{ service.id }}"><img class="icon-img-svg" title="View Contract Details" src="{% static 'images/sidebarIcon/document-viesw.svg' %}"/></a>
                          {% if service.save_type == 1 %}
                              {% if supply_count == 0 %}
                              <a href="{% url 'projects:editcontract' contracttype="original" pk=service.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              
                              {% else %}
                                  {% getActionContract service.id as contract_check %}
                                  {% if contract_check.contract_edit > 0 %}
                                  <a href="{% url 'projects:editcontract' contracttype="original" pk=service.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                                  {% endif %}
                              {% endif %}

                          {% else %}
                              {% check_querylist service.id 'original' as  checkquery %}
                              {% if checkquery > 0%}
                                <a href="{% url 'projects:editcontract' contracttype="original" pk=service.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              {% endif %}
                          {% endif %}

                          
                          
                        </td>
                    </tr>
                     <tr class="down-line-contra"> </tr>
                     
                     
                    {% endfor  %}
                    
                      </tbody>
                    </table>
                    {% endif %}


                    {% if contracts.id|supplycontractcount:"supply" > 0 %}
                    <h3 class="from-head">Supplies</h3>
                    <table class="type-last-vend mid-view-tbl tlt-cap m-ven-cus-mas tbl-contra-list contract-master-service-table">
                      <thead>
                      <tr>
                        <th class="wid-sn text-wrap">S/N</th>
                        <th class="text-wrap">Name of Supply</th>
                        <th class="text-wrap">Project Name</th>
                        <th class="text-wrap">Project Discipline</th>
                        <th class="text-wrap">Discipline Type</th>
                        <th class="text-wrap">PO Reference Number</th>
                        <th class="text-wrap">PO Executed Date</th>
                        <th class="text-wrap">Maximum Value of PO</th>
                      <th class="text-wrap"> Actions</th>
                      </tr>
                      </thead>
                      
                      <tbody class="seek-left">
                    {% for supply in contracts.id|supplycontract:"supply" %}
                    {% check_for_amendment supply.id request as supply_count %}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{supply.name_service|default_if_none:"---"}}</td>
                        <td class="td-left">{{supply.projects.projectname|default_if_none:"---"}}</td>
                        <td class="td-left">{{supply.projectdiscipline|convert_projectdiscipline|default_if_none:"---"}}</td>
                        <td>{{supply.projectdisciplinetype.discipline_subtype|default_if_none:"---"}}</td>
                        <td>{{supply.reference_number|default_if_none:"---"}}</td>
                        <td>{{supply.executed_date|checktime:request.user.company.id|default_if_none:"---"}}</td>
                        <td>{{supply.currency.currency_symbol|default_if_none:"---"}} {{supply.amount|amount_convertion_to_separtors|default_if_none:"---"}}</td>

                        
                        
                        <td>
                          {% if supply.save_type == 1 %}
                            {% if supply_count > 0 %}
                                {% with supply.id|check_contract_invoice:"original" as invoice_count %}
                                {% if invoice_count == 0 %}
                                {% if request.user.roles_id == 3 %}
                                  {% if rights.create == '1' or rights.edit == '1'%} 
                                    <a href="{% url 'projects:createvendortax' contracttype="original" id=supply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                                  {%endif%}
                                  {%else%}
                                  <a href="{% url 'projects:createvendortax' contracttype="original" id=supply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                                  {%endif%}
                                {% endif %}
                                {% endwith %}
                                {% with supply.id|check_contract_tax:"original" as tax_count %}
                                  {% if tax_count > 0 %}
                                    <a href="{% url 'projects:viewvendortax' contracttype="original" id=supply.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                                  {% endif %}
                                {% endwith %} 
                            {% endif %}
                          {% else %}
                            {% with supply.id|check_contract_invoice:"original" as invoice_count %}
                              {% if invoice_count == 0 %}
                              {% if request.user.roles_id == 3 %}
                                {% if rights.create == '1' or rights.edit == '1'%} 
                                  <a href="{% url 'projects:createvendortax' contracttype="original" id=supply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                                {%endif%}
                                {%else%}
                                <a href="{% url 'projects:createvendortax' contracttype="original" id=supply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                                {%endif%}
                              {% endif %}
                            {% endwith %}
                            {% with supply.id|check_contract_tax:"original" as tax_count %}
                              {% if tax_count > 0 %}
                                <a href="{% url 'projects:viewvendortax' contracttype="original" id=supply.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                              {% endif %}
                            {% endwith %} 
                          {% endif %}
                          <a href="/projects/contract_detailed_view/{{ supply.id }}"><img class="icon-img-svg" title="View Contract Details" src="{% static 'images/sidebarIcon/document-viesw.svg' %}"/></a>
                          {% if supply.save_type == 1 %}
                              {% if supply_count == 0 %}
                                <a href="{% url 'projects:editcontract' contracttype="original" pk=supply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              
                              {% else %}
                                  {% getActionContract supply.id as contract_check %}
                                  {% if contract_check.contract_edit > 0 %}
                                  <a href="{% url 'projects:editcontract' contracttype="original" pk=supply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                                  {% endif %}
                              {% endif %}
                          {%else %}
                              {% check_querylist supply.id 'original' as  checkquery %}
                              {% if checkquery > 0%}
                                <a href="{% url 'projects:editcontract' contracttype="original" pk=supply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              {% endif %}
                          {% endif %}
                        </td>
                        
                    </tr>
                    <tr class="down-line-contra"> </tr>
                    {% endfor  %}
                      </tbody>
                    </table>
                    {% endif %}


                    {% if contracts.id|servicesupplycontractcount:"service_supply" > 0 %}
                    <h3 class="from-head">Services & Supplies</h3>
                    <table class="type-last-vend mid-view-tbl tlt-cap tbl-contra-list contract-master-service-table">
                      <thead>
                      <tr>
                        <th class="wid-sn text-wrap">S/N</th>
                        <th class="text-wrap">Name of Contract</th>
                        <th class="text-wrap">Project Name</th>
                        <th class="text-wrap">Project Discipline</th>
                        <th class="text-wrap">Discipline Type</th>
                        <th class="text-wrap">CO Reference Number</th>
                        <th class="text-wrap">CO Executed Date</th>
                        <th class="text-wrap">Maximum Value of CO</th>
                       <th class="text-wrap">Actions</th>    
                      </tr>
                      </thead>
                      
                      <tbody class="seek-left">
                    {% for servicesupply in contracts.id|servicesupplycontract:"service_supply"%}
                    {% check_for_amendment servicesupply.id request as supply_count %}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{servicesupply.name_service|default_if_none:"---"}}</td>
                        <td class="td-left">{{servicesupply.projects.projectname|default_if_none:"---"}}</td>
                        <td class="td-left">{{servicesupply.projectdiscipline|convert_projectdiscipline|default_if_none:"---"}}</td>
                        <td>{{servicesupply.projectdisciplinetype.discipline_subtype|default_if_none:"---"}}</td>
                        <td>{{servicesupply.reference_number|default_if_none:"---"}}</td>
                        <td>{{servicesupply.executed_date|checktime:request.user.company.id|default_if_none:"---"}}</td>
                        <td>{{servicesupply.currency.currency_symbol|default_if_none:"---"}} {{servicesupply.amount|amount_convertion_to_separtors|default_if_none:"---"}}</td>
                        
                        <td>
                          {% if servicesupply.save_type == 1 %}
                          {% if supply_count > 0 %}
                          {% with servicesupply.id|check_contract_invoice:"original" as invoice_count %}
                            {% if invoice_count == 0 %}
                            {% if request.user.roles_id == 3 %}
                              {% if rights.create == '1' or rights.edit == '1'%} 
                              <a href="{% url 'projects:createvendortax' contracttype="original" id=servicesupply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              {%else%}
                              <a href="{% url 'projects:createvendortax' contracttype="original" id=servicesupply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                            {% endif %}
                          {% endwith %}
                          {% with servicesupply.id|check_contract_tax:"original" as tax_count %}
                            {% if tax_count > 0 %}
                              <a href="{% url 'projects:viewvendortax' contracttype="original" id=servicesupply.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                            {% endif %}
                          {% endwith %}
                          {% endif %}
                          {% else %}
                          {% with servicesupply.id|check_contract_invoice:"original" as invoice_count %}
                            {% if invoice_count == 0 %}
                            {% if request.user.roles_id == 3 %}
                              {% if rights.create == '1' or rights.edit == '1'%} 
                              <a href="{% url 'projects:createvendortax' contracttype="original" id=servicesupply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                              {%else%}
                              <a href="{% url 'projects:createvendortax' contracttype="original" id=servicesupply.id %}"><i title='Add/Edit Taxes & Currency Split' class="fas fa-plus checkfilecls" ></i></a>
                              {%endif%}
                            {% endif %}
                          {% endwith %}
                          {% with servicesupply.id|check_contract_tax:"original" as tax_count %}
                            {% if tax_count > 0 %}
                              <a href="{% url 'projects:viewvendortax' contracttype="original" id=servicesupply.id %}"><i title='View Taxes & Currency Split' class="fas fa-eye checkfilecls" ></i></a>
                            {% endif %}
                          {% endwith %}

                          {% endif %}

                          <a href="/projects/contract_detailed_view/{{ servicesupply.id }}"><img class="icon-img-svg" title="View Contract Details" src="{% static 'images/sidebarIcon/document-viesw.svg' %}"/></a>
                          {% if servicesupply.save_type == 1 %}
                              {% if supply_count == 0 %}
                                <a href="{% url 'projects:editcontract' contracttype="original" pk=servicesupply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              {%else%}
                                  {% getActionContract servicesupply.id as contract_check %}
                                  {% if contract_check.contract_edit > 0 %}
                                  <a href="{% url 'projects:editcontract' contracttype="original" pk=servicesupply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                                  {% endif %}
                              {% endif %}
                          {%else %}
                              {% check_querylist servicesupply.id 'original' as  checkquery %}
                              {% if checkquery > 0%}
                              <a href="{% url 'projects:editcontract' contracttype="original" pk=servicesupply.id %}"><i title='Edit Contract' class="fas fa-edit" ></i></a>
                              {% endif %}
                          {% endif %}
                        </td>
                       
                    </tr>
                  <tr class="down-line-contra"> </tr>
                    {% endfor  %}
                      </tbody>
                    </table>
                    {% endif %}
                  </div>
                </div>
            </td>
          </tr>
            {% endfor %}
            {% else %}
            <tr>
              <td colspan="7" class="cls-nil td-center">
                ---
              </td>
            </tr>
            {% endif %}

        </tbody>
    </table>
    </div>
<!-- 
    {{request.GET.sortname}}
    {{request.GET.sortvendorname}}
    {{request.GET.vendor}} -->
      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center">
        {% if contractlist.has_previous %}
            <li class="page-item">
            <a class="btn-clr page-link" href="{{ request.META.HTTP_REFERER }}">Previous</a>
          </li>
        {% else %}
            <li class="page-item disabled">
            <a class="btn-clr page-link" href="#" tabindex="-1" aria-disabled="True">Previous</a>
          </li>
        {% endif %}

        {% if contractlist.number|add:'-4' > 1 %}
            <li class="page-item pg-count"><a class="page-link pg-circle" href="?page={{ contractlist.number|add:'-5' }}">&hellip;</a></li>
        {% endif %}

        {% for i in contractlist.paginator.page_range %}
            {% if contractlist.number == i %}
                <li class="page-item pg-count active" aria-current="page">
              <span class="btn-clr pg-circle page-link">
                {{ i }}
                <span class="sr-only">(current)</span>
              </span>
            </li>
            {% elif i > contractlist.number|add:'-5' and i < contractlist.number|add:'5' %}

              {% if request.GET.vendor %}
            <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?vendor={{request.GET.vendor}}&page={{ i }}">{{ i }}</a></li>
              {% elif request.GET.vendor and request.GET.sortname %}
              <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?vendor={{request.GET.vendor}}&sortname={{request.GET.sortname}}&page={{ i }}">{{ i }}</a></li>
              {% elif request.GET.vendor and request.GET.sortvendorname %}
              <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?vendor={{request.GET.vendor}}&sortvendorname={{request.GET.sortvendorname}}&page={{ i }}">{{ i }}</a></li>
              {% elif request.GET.sortname %}
              <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?sortname={{request.GET.sortname}}&page={{ i }}">{{ i }}</a></li>
              {% elif request.GET.sortvendorname %}
              <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?sortvendorname={{request.GET.sortvendorname}}&page={{ i }}">{{ i }}</a></li>
              {% else %}
                <li class="page-item pg-count"><a class="page-link pg-circle" data-id="{{ i }}" href="?page={{ i }}">{{ i }}</a></li>
              {% endif %}
            {% endif %}
      {% endfor %}
        {% if contractlist.paginator.num_pages > contractlist.number|add:'4' %}
          <li class="page-item pg-count"><a class="page-link pg-circle" href="?page={{ contractlist.number|add:'5' }}">&hellip;</a></li>
        {% endif %}

        {% if contractlist.has_next %}
            <li class="page-item pg-count">
            <a class="btn-clr page-link" href="?page={{ contractlist.next_page_number }}">Next</a>
          </li>
        {% else %}
            <li class="page-item disabled">
            <a class="btn-clr page-link" href="#" tabindex="-1" aria-disabled="True">Next</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </form>
</div>
<div class="row">
  {% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <li  {% if message.tags %} class="{{ message.tags }} msg-cls"{% endif %} style="display:none;"> {{ message }} </li>
      {% endfor %}
  </ul>
{% endif %}
</div>
<form method="POST" id="">
  {% csrf_token %}
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header comment-head">
        <h5 class="modal-title" id="exampleModalCenterTitle">Amendment/Addendum</h5>
        <button type="button" class=" modal_close"  data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body comment-body">
        <table>
          <thead>
            <tr id="content-head" >
              <th class="text-wrap">
                WCC <i class="fa fa-info-circle" title="Work Completion Certificate Submission Required"></i>
              </th>
              <th class="text-wrap">Type</th>
              <th class="text-wrap">CO Reference Number</th>
              <th class="text-wrap">CO Executed Date	</th>
              <th class="text-wrap">Maximum Value	 of CO</th>
              <th class="text-wrap">Upload Contract	</th>
              <th class="text-wrap">Upload Price Table</th>
              <th class="text-wrap">Actions</th>
            </tr>
          </thead>
        <tbody>
        <tr> 
          <td class="text-center">
            <input type="checkbox" class="wcc-cbx amend_wcc_flow_cls" name="wcc" value="1"> 
            <input type="hidden" value="0" name="wcc_check">
          </td>  
          <td class="edit-addme-wid">
            <select name="ammendment_type" class="form-control"> 
              <option value="">--Select--</option> 
              <option value="Amendment">Amendment</option> 
              <option value="Addendum">Addendum</option> 
            </select>
          </td> 
          <td>
            <textarea rows="3" cols="30" placeholder="Reference Number" name="ref_num" class="form-control refcls">

            </textarea>
          </td> 
          <td>
            <input type="text" name="dateformat_contract" autocomplete="off" class="dateformat-cls form-control" inv_count="">
          </td> 
          {% if company.currency == None %}
          {% else %}
          <td>
            <select id="maximum_value" name="currency_contract" class="maximum-extra-cls form-control">
              <option value=''>--Select--</option>
              {% with company.currency|get_currencies:"-" as currencies %}
              {% for currency in currencies %} 
              <option value="{{currency.id}}"> {{currency.currency}} {{currency.currency_symbol}} ({{currency.name}}) </option> 
              {% endfor %}
            {% endwith %}

            </select>
            <input type="text" list="browsers" id="amount_currency" name="amount_currency" class="amount_currency_cls form-control contra-currency" autocomplete="off"> 
            <datalist id="browsers">
              <option value="No Max Limit">

            </td> 
          {%endif %}
            <td>
              <input type="file" accept="image, .png, .jpeg, .pdf, .jpg" name="'+val+'con_file'+setindexval+tableindex+'" class="form-control filesize"><br><span class="maxmp">(Max: 25MB)</span><br><span class="file-error-message"></span>
            </td> 
            <td>
              <input type="file" accept="image, .png, .jpeg, .pdf, .jpg" name="'+val+'price_file'+setindexval+tableindex+'" class="form-control filesize"><br><span class="maxmp">(Max: 25MB)</span><br><span class="file-error-message"></span>
            </td> 
            
          </tr>
        </tbody>
        </table>
        </div>
      <div class="modal-footer comment-foot">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="submit_id">Submit</button>
      </div>
    </div>
  </div>
</div>
</div>
</section>
{% endblock %}
{% block scripts %}
{{ block.super }}
<script>
 /* $( document ).ready(function() {
    $('.downloadcls').hide();
    // var notyf = new Notyf({
    //   duration: 2000,
    //   position: {
    //     x: 'right',
    //     y: 'top',
    //   },
    //   types: [
    //     {
    //       type: 'success',
    //       background: 'green',
    //       icon: {
    //         className: 'fa fa-check-circle',
    //         tagName: 'i',
    //         color: 'white',
    //       },
    //     },
    //   ]
    // });
  
    // var msg=$('.msg-cls').text();
    // if (msg){
    //   notyf.open({
    //   type: 'success',
    //   message: msg,
    // });
    // }
    // else{
    //   console.log($('.msg-cls'));
    // }
  // $('#submitbtn').prop('disabled', true);
 /* var notyf = new Notyf({
      duration: 3000,
      position: {
        x: 'right',
        y: 'top',
      },
      types: [
        {
          type: 'success',
          background: '#D3D3D',
          icon: {
            className: 'fa fa-check-circle',
            tagName: 'i',
            color: '#000',
          },
        },
      ]
    }); */
/*
  var msg=$('.msg-cls').text();
  if (msg){
  swal.fire(msg);
  } 
  })
    $(function() {
    
      $("form[id='con_form']").validate({ 
          
        rules: {
        
            projects:{
                required: true,
                
            }, 
            project_discipline:{
                required: true,
                
            },
            disciplinetype:{
                required: true,
            },
            contractfile:{
              required: true,
              extension: "xlsx",
          },
        },
        messages: {  
          projects:
                 {
                     required :"This Field is Required",
                  
                 },
                 project_discipline:
                 {
                     required :"This Field is Required",
                  
                 },
                 disciplinetype:
                 {
                     required :"This Field is Required",
                  
                 },
                 contractfile:
                 {
                     required :"This Field is Required",
                     extension:"xls file format only allowed"
                  
                 },
                },
                submitHandler: function(form) {
                  form.submit();
                  $('#loader').removeClass('hidden')
              },
         
          });
   });


   $(document).on('click','.con_file_id' ,function (){
    filedata = new FormData($('form').get(0));
   
   $.ajax({
       url: '/projects/contractmasterlist',
       type: 'post',
       data: filedata,
       cache: false,
       processData: false,
       contentType: false,
       success: function(data) {
         var current_url=$(location).attr("href")
         var replace_url=current_url.replace("contractmasterlist","checkvendorcontractimport")
         window.location.href = replace_url;
       }
   })
   return false;
});  */
$(document).on('click','.con_file_id',function(e){
  let id_projects=$('#id_projects').val()
  let project_discipline=$('#project_discipline').val()
  let disciplinetype_id=$('#disciplinetype_id').val()
  if((id_projects=='') || (project_discipline=='') || (disciplinetype_id='')){
    e.preventDefault()
  }
  if(id_projects==''){
    $('#id_projects').css('border','1px solid red')
  }
  if(project_discipline==''){
    $('#project_discipline').css('border','1px solid red')
  }
  if(disciplinetype_id==''){
    $('#disciplinetype_id').css('border','1px solid red')
  }
})

$(document).on('change','#id_projects,#project_discipline,#disciplinetype_id',function(){
  if($(this).val() !=''){
    $(this).css('border','')
  }
})


$(document).on('change','.checkfileformat',function(){
  var val=$(this).val()
  if (val !="" && val.split('.').pop()=='xlsx'){
    $('.con_file_id').prop('disabled', false);
  }
  else{
    $('.con_file_id').prop('disabled', true);
  }
})

$(document).ready(function(){
    var val=$('.checkfileformat').val()
    if (val !="" && val.split('.').pop()=='xlsx'){
      $('.con_file_id').prop('disabled', false);
    }
    else{
      $('.con_file_id').prop('disabled', true);
    }
})

</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>  
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/additional-methods.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" ></script>

<script>

$(document).ready(function() {
     $(".showtoggle").on('click', function() {
 
 let nxttr = $(this).closest('tr').next('tr');
 console.log(nxttr)
 $(this).closest('table tbody').find('.collapse').not(nxttr.find('.collapse')).removeClass('show');
});

});
 
        
$(document).on('click','.checkfilecls',function(e){
  var confile=$(this).closest('tr').find('.con-file a').text()
  var prifile=$(this).closest('tr').find('.pri-file a').text()
  var contract_price_file=$(this).closest('tr').find('.pri-file .price_table_count').val()
  
  if (confile == "" && contract_price_file > 0){
    e.preventDefault()
    swal.fire('Add Contract File')
  }
  else if (confile != "" && contract_price_file == 0){
    e.preventDefault()
    swal.fire('Add Price Table File')
  }
  else if (confile == "" && contract_price_file == 0){
    e.preventDefault()
    swal.fire('Add Contract File and Price Table File')
  }

})


  var filedata;
  var missedarray=[]
  var existscontracts=[]
    $(document).on('click','.delete-contract',function(){
      contract_id=$(this).attr('data_id')
      vendor_name=$(this).attr('contract_name')
      Swal.fire({
        title: 'Are you sure you want to delete '+vendor_name,
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, I Confirm',
        cancelButtonText: 'No',
      }).then((result) => {
        if (result.isConfirmed) {
           $.ajax({
          type: "GET",
          url:'/projects/contractmasterdelete',
          data: {
            "id":contract_id,
          },
          success: function(data)
          {
            console.log(data)
            setTimeout(function(){  
            location.reload();  
            },100);
          }
           });
          Swal.fire('Vendor Deleted Successfully')
        }
    })
    })


    
    $(document).on('change','.projectcls',function(){
      let title = $(this).find(':selected').attr('title');
      $('.p_discipline_cls').attr('title','')
      $('.p_discipline_cls').attr('title',title)
      var val=$(this).val()
      $('#disciplinetype_id').html('<option value="">--Select--</option>')
      $('.p_discipline_cls').html('<option value="">--Select--</option>')

          $.ajax({
              type:"GET",
              url:'/projects/companyprojectdevelopment',
              data:{'projectid':val},
              success: function(data){
                  console.log(data)
                  var html=''
                  html +='<option value="">--Select--</option>'
                  $.each(data.data,function(key,val){
                          html +='<option title="'+val.fieldname+'" value='+val.id+'>'+val.fieldname+'</option>'
                  })
                  $('.p_discipline_cls').html(html)
              }
          })
  })


  $(document).on('change','.p_discipline_cls',function(){
      var val=$(this).val()
      if (val == ''){
          $('#disciplinetype_id').html('<option value="">--Select--</option>')
      }
      else{
        
          $.ajax({
              type:"GET",
              url:'/projects/companyprojectdevelopment',
              data:{'projectdisciplineid':val},
              success: function(data){
                  console.log(data)
                  var html=''
                  html +='<option value="">--Select--</option>'
                  $.each(data.data,function(key,val){
                      html +='<option title="'+val.text+'" value='+val.value+'>'+val.text+'</option>'
                  })
              $('#disciplinetype_id').html(html)
              $('').attr('title')
              }
          })
      }

  })

  $(document).on('change','#disciplinetype_id',function(){
    
    $('.downloadcls').show();
  })





 $(document).on('click','#download_prev' ,function (){
  //console.log(missedarray)
  var missed_json = JSON.stringify(missedarray)
  var exists_json = JSON.stringify(existscontracts)
  //var missed=$('#file_data').html()
  //var exists=$('#exists_contract_id').html()
  
  $.ajax({
    url: '/projects/downloaduploadcontractdata',
    type: 'GET',
    data:{'missed':missed_json,
          'exists_contract':exists_json},
    success: function(data) {
      console.log(data)
    }
  });
});
  

 
   //searching and sorting
  //  var url="{{ request.path }}"
  var main_url = window.location.href.split("?")[0];
//    $('.v_search').on('click',function(){
//     var name=$('#myInput').val();
//     console.log('name',name)
//     console.log('main_url',main_url)

//     // console.log(currentUrlWithoutParams)
//     // var current_main_url=$(location).attr("href")
//     // alert(main_url+'?vendor='+name)
//     window.location.href = main_url+'?vendor='+name
// })


   $(document).on('click','.sort',function(){
  var name=$('#myInput').val();
  var sortname=$(this).attr("name");

  if (name){
    if (sortname=='asc')
    {
      var current_url=$(location).attr("href")
      window.location.href = main_url+'?vendor='+name+'&sortname=ascending'
    }
    else
    {
      var current_url=$(location).attr("href")
      replace_url=current_url.replace('&sortname=ascending','')
window.location.href = main_url+'?vendor='+name+'&sortname=descending'

      
    }
  }
  else{
    if (sortname=='asc')
    {
      var current_url=$(location).attr("href")
    
      window.location.href = main_url+'?sortname=ascending'
      // alert(url+'?sortname=ascending')
    }
    else
    {
      var current_url=$(location).attr("href")
      window.location.href = main_url+'?sortname=descending'
      
      // alert(url+'?sortname=ascending')
    }
  }



});



//sort by vendor name

$(document).on('click','.sortname',function(){
  var name=$('#myInput').val();
  var sortvendornamename=$(this).attr("name");

  if (name){

    if (sortvendornamename=='asc')
    {
      var current_url=$(location).attr("href")
      window.location.href = main_url+'?vendor='+name+'&sortvendorname=ascending'
    }
    else
    {
      var current_url=$(location).attr("href")
      replace_url=current_url.replace('&sortvendorname=ascending','')

      window.location.href = main_url+'?vendor='+name+'&sortvendorname=descending'
    }
  }
  else{
    if (sortvendornamename=='asc')
    {
      var current_url=$(location).attr("href")
 
      window.location.href = main_url+'?sortvendorname=ascending'

    }
    else
    {
      var current_url=$(location).attr("href")
      replace_url=current_url.replace('&sortvendorname=ascending','')

      window.location.href = main_url+'?sortvendorname=descending'
    }
}
});



// $(document).on('keyup','#myInput',function(){
//     var searchtext=$(this).val();
//     // alert(searchtext)
 
//   if(searchtext!='')
//   {
    
//   }
//   else
//   {
//     window.location.href= main_url
//   }
// } );



$('input[name=searchvendor]').on('keyup keypress', function(event) {
  var searchtext=$('#myInput').val();
  var keycode = (event.keyCode ? event.keyCode : event.which);
  console.log('keycode',keycode)
  if(keycode == '13'){
    if(searchtext!='')
      {
        console.log('searchtext',searchtext)
        window.location.href= main_url+'?vendor='+searchtext
      }
    else
      {
        window.location.href= main_url                         
      }
  }
  // console.log('main_url',main_url)
});



$(document).on('click','.commoncls',function(){
  if ($(this).is(':checked')){
    $(".reportcls").find('input[type=checkbox]').each(function () {
      this.checked = true;
    });
  }
  else{
    $(".reportcls").find('input[type=checkbox]').each(function () {
      this.checked = false;
    });
  }
})

// search and pagination

$('input').on('change', function () {
    const queryString = window.location.search;
    const parameters = new URLSearchParams(queryString);
    const value = parameters.get('q');
    if (value != null && $(this).val() == '') {
        window.location.href = `scheme://gethost/projects/contractmasterlist`
    }
});

$(document).on('input', "#myInput", function () {
   
   
   let query = $(this).val()
   let pageperdata = $('#datafilters').val()
   
   setTimeout(function () {
       searchContract(query,1,pageperdata)
       }, 100);

});
$(document).on('click','.pg-circle',function(e){
   e.preventDefault();
   let query = $('#myInput').val();
   let page = $(this).attr('data-id')
   let pageperdata = $('#datafilters').val()
   console.log({'page':  page })
   searchContract(query,page,pageperdata)
})
$(document).on('change','.changevalue',function(e){
   
   let query = $('#myInput').val();
   //let page = $(this).attr('data-id')
   let pageperdata = $(this).val()
   console.log({'csrf_tokensearchList':  pageperdata })
   searchContract(query,1,pageperdata)
});

function searchContract(query,page,pageperdata) {
   console.log(query,page,pageperdata)
   $.ajax({
       url: "/projects/contractmasterlist",
       headers: {'X-CSRFToken': '{{csrf_token}}' },
       data: { 
           'q': query,
           'page':page,
           'pageperdata':pageperdata
       },
       type: 'POST',
       success: function (response) {
           if (response.status) {
               console.log('right')
               console.log(response)
               $('section').replaceWith(response.html)
               let focusElement = $(document).find('#myInput')
               let elementLength = focusElement.val().length;
               focusElement[0].focus();
               focusElement[0].setSelectionRange(elementLength,elementLength);
               $('#datafilters').val($('.entries').val())
           } else {
               console.log('wrong')
           }
       },
       error: function () {
           // Error message
       }
   });
}
$('.modal_close').click(function(){
  $(this).modal('close');
})

var hdn_dateformat=$('#companydateformat').val()

if (hdn_dateformat ==''){
  $(document).on('focus',".dateformat-cls", function(){
          $(this).datepicker({
              dateFormat: 'dd-M-yy',
              maxDate:new Date(),
              yearRange: '1900:+0',
              changeMonth:true,
              changeYear:true,
          });
    });
}
else{
  $(document).on('focus',".dateformat-cls", function(){
          $(this).datepicker({
              dateFormat: hdn_dateformat,
              maxDate:new Date(),
              yearRange: '1900:+0',
              changeMonth:true,
              changeYear:true,
          });
    });
}


</script>
{% endblock %}
